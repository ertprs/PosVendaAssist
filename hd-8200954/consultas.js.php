<?php
header("Content-Type: text/javascript; charset=utf-8");include_once'../trad_site/fn_ttext.php';include_once'trad_consultas.php';$my_prg_ver='6.20';$cook_idioma=$_COOKIE['cook_idioma'];list($usr_login,$usr_senha)=explode("|",$_COOKIE['clogin']);$usr_cfg_ini="cfg/{$usr_login}_cfg.ini";$fundo='imagens/tc_bg.jpg';if(file_exists($usr_cfg_ini)){include($usr_cfg_ini);extract($usr_cfg);}$posto_ini=($posto_ini=='')?'login.php':$posto_ini.'.php';$admin_ini=($admin_ini=='')?'':'admin/'.$admin_ini.'.php';?>var urlAssist='http://posvenda.telecontrol.com.br/assist';var posto_ini_page='<?=$posto_ini?>';var admin_ini_page='<?=$admin_ini?>';var program_self=location.pathname;<?var aba_ativa;var selValue;var filtroDatas;var outroVal;var sorter=new TINY.table.sorter('sorter');function createjscssfile(filename,filetype){if(filetype=="js"){var fileref=document.createElement('script')fileref.setAttribute("type","text/javascript")fileref.setAttribute("src",filename)}else if(filetype=="css"){var fileref=document.createElement("link")fileref.setAttribute("rel","stylesheet")fileref.setAttribute("type","text/css")fileref.setAttribute("href",filename)}return fileref}function replaceCSSFile(oldfilename,newfilename){var targetelement="link";var targetattr="href";var allsuspects=document.getElementsByTagName(targetelement);for(var i=allsuspects.length;i>=0;i--){if(allsuspects[i]&&allsuspects[i].getAttribute(targetattr)!=null&&allsuspects[i].getAttribute(targetattr).indexOf(oldfilename)!=-1){var newelement=createjscssfile(newfilename,'css');allsuspects[i].parentNode.replaceChild(newelement,allsuspects[i]);}}}$(document).ready(function(){$('#toggle_lng').val(idioma);$('#toggle_lng').data({'mic_pt-BR':"<?=ttext($a_trad,'muda_idioma_confirma','pt-BR')?>",'mic_es':"<?=ttext($a_trad,'muda_idioma_confirma','es')?>",'mic_en':"<?=ttext($a_trad,'muda_idioma_confirma','en')?>",'ai_pt-BR':"<?=ttext($a_trad,'alterando_idioma','pt-BR')?>",'ai_es':"<?=ttext($a_trad,'alterando_idioma','es')?>",'ai_en':"<?=ttext($a_trad,'alterando_idioma','en')?>",'mir_pt-BR':"<?=ttext($a_trad,'muda_idioma_req','pt-BR')?>",'mir_es':"<?=ttext($a_trad,'muda_idioma_req','es')?>",'mir_en':"<?=ttext($a_trad,'muda_idioma_req','en')?>",'qry_pt-BR':"<?=ttext($a_trad,'realizando_consulta','pt-BR')?>",'qry_es':"<?=ttext($a_trad,'realizando_consulta','es')?>",'qry_en':"<?=ttext($a_trad,'realizando_consulta','en')?>",});var traducao=$('#toggle_lng');$('#resultados').ajaxSend(function(e,xhr,settings){if(settings.url==location.pathname){$(this).html('<p>&nbsp;&nbsp;'+traducao.data("qry_"+traducao.val())+'</p>');}});$.datepicker.setDefaults($.extend({dateFormat:'dd/mm/yy',showMonthAfterYear:false,changeMonth:true,constrainInput:true},$.datepicker.regional['<?=$cook_idioma?>']));$('button').addClass('small');$('form button[type!=reset]').addClass('blue');$('form button[type=reset]').addClass('red');$('#test_db').draggable().css('cursor','move');$("#SQLslider").slider({orientation:"horizontal",range:"min",min:0,max:200,value:100,step:5,slide:function(event,ui){$("#limiteSQL").val(ui.value);}});$('#limiteSQL').focus(function(){$('#SQLslider').fadeIn('fast');}).keyup(function(){$("#SQLslider").slider("value",$(this).val());});$('#notebook_ta').val('');$('#notebook').dialog({autoOpen:false,buttons:{<?=ttext($a_trad,'btn_fechar')?>:function(){$(this).dialog('close');},<?=ttext($a_trad,'btn_limpar')?>:function(){$('#notebook_ta').val('');}},stack:true,resizable:true,draggable:true,position:['right','middle'],height:300,zIndex:2000,addClass:'fixedPos'});$('#nb_btn').click(function(){acao=($('#notebook').dialog('isOpen'))?'close':'open';$('#notebook').dialog(acao);});$('#abas').dblclick(function(){if($('#abas').css('width')!='5px'){$('#abas').animate({width:'5px'},{queue:false,duration:500});$('#abas span').css('visibility','hidden');$('#resultados').animate({left:'20px'},{queue:true,duration:500}).css('width','98%');$('#toggle_lng').hide();}else{$('#abas').animate({width:'145px'},{queue:true,duration:500});$('#abas span').css('visibility','visible');$('#resultados').css('width','85%').animate({left:'150px'},{queue:false,duration:500});$('#toggle_lng').show();}});$('#abas span').addClass('off').click(function(){activa($(this).attr('id'));});$('input.numeric').keypress(function(ev){var numcheck=/\d|-/;return numcheck.test(String.fromCharCode(ev.which));}).change(function(){var soNums=$(this).val();var filtro=/\D/g;$(this).val(soNums.replace(filtro,""));});$('#posto_ini_page,#admin_ini_page').change(function(){valor=$(this).val();outro='#'+$(this).attr('name')+'_outra';if(valor=='outra'){$(outro).fadeIn('fast');}else{$(outro).fadeOut('fast').val('');}});$('input[name*=data]').focus(function(){outroVal='input[name='+$(this).attr('name')+']';if(!$('#datas').dialog('isOpen'))$('#datas').dialog('open');});$('select[name*=outro]').change(function(){selValue=$(this).val();outroVal='input[name='+$(this).attr('name')+'_value]';$(outroVal).val('');if(selValue!=''){$(outroVal).css('display','inline');if(selValue.indexOf('data')>=0||selValue=='primeiro_acesso'||selValue=='email_autenticado'){if(!$('#datas').dialog('isOpen'))$('#datas').dialog('open');}}else{$(outroVal).css('display','none');}});$('#hds').dialog({autoOpen:false,buttons:{<?=ttext($a_trad,'btn_aceitar')?>:function(){$('input[name=hd_num]').val($('#hds_lista').val());$('#acao_logado button[name=helpdesk]').click();},<?=ttext($a_trad,'btn_cancelar')?>:function(){$(this).dialog('close');}},position:["right",120],resizable:false});$('#abre_lista_hd').click(function(){acao=(!$('#hds').dialog('isOpen'))?'open':'close';$('#hd_info').html('').hide();$('#hds').dialog(acao);});$('#hds_lista').dblclick(function(){$('input[name=hd_num]').val($(this).val());$('#acao_logado button[name=helpdesk]').trigger('click');$('#hds').dialog('close');});$('#hds_lista').change(function(){hd=$(this).val();$('#hd_info').html('<?=ttext($a_trad, 'acessando')?>');$.get(program_self,{'ajax':'sim','acao':'info_hd','hd':hd},function(info){if(info.length>0){$('#hd_info').html(info).slideDown('fast');$('label[for=delHD]').show('fast');}else{$('#hd_info').html('').slideUp('fast');$('label[for=delHD]').hide('fast');}});});$('label[for=delHD]').click(function(){$('#hds_lista option:selected').remove();$('#hds_lista option:last').attr('selected','selected');$('#hd_info').slideUp('fast');});$('#addHD').click(function(){hd=$('input[name=newHD]').val();if($('#hds_lista').html().indexOf(hd)==-1){$('#hds_lista').append('<option value="'+hd+'">HD nº '+hd+'</option>');$('#hds_lista option:last').attr('selected','selected');$.get(program_self,{'ajax':'sim','acao':'info_hd','hd':hd},function(info){if(info.length>0){$('#hd_info').html(info).slideDown('fast');}else{$('#hd_info').slideUp('fast');}$('label[for=delHD]').show('fast');});}});$('#datas input').datepicker();$('div#datas').dialog({autoOpen:false,buttons:{<?=ttext($a_trad,'btn_aceitar')?>:function(){if($('#datas select').val().indexOf('WEEN')>0){filtroDatas=$('#datas select').val()+"^"+$('#datas input[name=ini_date]').val()+"^ AND ^"+$('#datas input[name=end_date]').val()+"^";}else{filtroDatas=$('#datas select').val()+"^"+$('#datas input[name=ini_date]').val()+"^";}$(outroVal).val(filtroDatas);filtroDatas='';$(this).dialog('close');},<?=ttext($a_trad,'btn_cancelar')?>:function(){$(this).dialog('close');}},resizable:false});$('#datas select').change(function(){if($(this).val().indexOf('WEEN')>0){$('#datas span').show('fast');}else{$('#datas span').hide('fast');}});$('#do_that button[name=limpaResultado]').click(function(){$('#resultados').empty();});$('#acao_logado button[name=helpdesk]').click(function(){hd=$('input[name=hd_num]').val();if(document.do_that.logado.value=="si"){var login=document.do_that.user.value;var senha=document.do_that.pass.value;if(hd==''){logar_como(login+"|"+senha,"mlg_logar",urlAssist+'/helpdesk/adm_atendimento_lista.php');}else{logar_como(login+"|"+senha,"mlg_logar",urlAssist+'/helpdesk/adm_chamado_detalhe.php?hd_chamado='+hd);if($('#hds_lista').html().indexOf(hd)==-1){$('#hds_lista').append('<option value="'+hd+'">HD nº '+hd+'</option>');}$('input[name=hd_num]').val('');}}});$('span#callcenter').click(function(){if(document.do_that.logado.value=="si"){var login=document.do_that.user.value;var senha=document.do_that.pass.value;logar_como(login+"|"+senha,"mlg_logar",urlAssist+'/admin/callcenter_pendente_interativo.php');}});$('span#consultas_hd').click(function(){window.open('./consultas_hd.php');});$('#togglecss').click(function(){var sup='Menu sup.>>';var lat='Menu lat.>>';if($('#togglecss').text()==lat){replaceCSSFile('consultas.css','consultas2.css');$('#togglecss').text(sup);}else{replaceCSSFile('consultas2.css','consultas.css');$('#togglecss').text(lat);}});$('#lf_fabrica').change(function(){if($(this).val()!="")logar_como($(this).val(),"mlg_pedir_login","");});$('select#toggle_lng').change(function(){if($(this).val()!=""){aviso_text=traducao.data("mic_"+traducao.val());var aceita=confirm(aviso_text);if(aceita){aviso_text=traducao.data("ai_"+traducao.val());setCookie("cook_idioma",$(this).val());$("#resultados").html("<div id='newver_msg_block'>"+aviso_text+"</div>");window.location.reload();return false;}else{aviso_text=traducao.data("mir_"+traducao.val());aceita=confirm(aviso_text);if(aceita){setCookie("cook_idioma",$(this).val());}}}});});function atualizaListaArquivos(){$.post(program_self,{'ajax':'sim','acao':'files_list','prg_ver':'<?=$my_prg_ver?>'},function(resposta){$('#frm_ar > fieldset table').remove();$('#frm_ar > fieldset').append(resposta);$('span.anexo').css('cursor','pointer').click(function(){var url=$(this).text();var div_res='#resultados';var formatoCSV=false;if(url.indexOf('.csv')>0){$(div_res).html('<pre></pre>');div_res+='>pre';formatoCSV=true;}$(div_res).load(url);});$('#frm_ar > fieldset > table > tbody > tr td img.excluir').click(function(){arquivo=$(this).attr('alt');if(arquivo==undefined)return false;if((window.confirm('<?=ttext($a_trad,'msg_excluir_confirm')?>'))&&arquivo.length>0){$.post(program_self,{'ajax':'sim','acao':'sq','excluir':'arquivo','arquivo':arquivo,'prg_ver':'<?=$my_prg_ver?>'},function(data){alert(data);if(data.indexOf('sucesso')){atualizaListaArquivos();}});}});$('#resultados').html('');});}function activa(id,r){aba_ativa=id.substr(4,2);if(aba_ativa=='an'){var aniversarios='http://posvenda.telecontrol.com.br/assist/admin/aniv_relatorio.php';var user=$('#do_that input[name=user]').val();if(user=='manuel'||user=='roberta'){window.open(aniversarios);return true;}$('#resultados').html('Carregando aniversários').load(aniversarios+' #anivs',function(){$(this).find('form').remove();});return true;}if(aba_ativa=='ar'){atualizaListaArquivos();}var frm_ativo="frm_"+aba_ativa;var frm_id="#"+id.substr(4,2);$("#abas span.on").removeClass('on').addClass('off');$('#'+id).removeClass('off').addClass("on");$("#formulario div").hide();$(frm_id).show();if(!r)$("#acao").val(id);shortcut.remove("enter");if(aba_ativa!='lf'){shortcut.add("enter",function(){consulta(document.getElementById('frm_'+aba_ativa),aba_ativa);});}else{shortcut.add('enter',function(){logar_como($('#lf_fabrica').val(),"mlg_pedir_login","");});}$(frm_id+' input:first').focus();}function usar_bd_teste(usar){$('#resultados').empty();document.body.style.backgroundColor=(usar.checked)?'#fee':'#fff';document.getElementById('test_db').style.borderStyle=(usar.checked)?'inset':'outset';}function loga(user,pass){var frm=document.getElementById('do_that');$('#login').hide();document.getElementById('acao_select').style.display="inline";document.getElementById('acao_logado').style.display="inline";$('#logado').val("si");$('#showuser').html(user);frm.user.readonly="READONLY";frm.pass.readonly="READONLY";activa("aba_pp",false);}function lista_lu(posto){activa("aba_lu");var frm=document.getElementById('frm_lu');frm.reset();frm.lu_outro.value="tbl_login_unico#posto";frm.lu_outro_value.value=posto;frm.lu_outro_value.style.display='inline';consulta(frm,'lu');}function atende_fabricas(posto){activa("aba_af");var frm=document.getElementById('frm_af');frm.reset();frm.posto_af.value=posto;consulta(frm,'af');}function consulta_extrato(extrato){activa("aba_ex");var frm=document.getElementById('frm_ex');frm.reset();$('#frm_ex #extrato').val(extrato);consulta(frm,'ex');}function consulta_pedido(pedido){activa("aba_pd");var frm=document.getElementById('frm_pd');frm.reset();$('#frm_ex #pedido').val(pedido);consulta(frm,'pd');}function info_posto(posto){activa("aba_pp");var frm=document.getElementById('frm_pp');frm.reset();frm.pp_outro1.value="tbl_posto#posto";frm.pp_outro1_value.value=posto;frm.pp_outro1_value.style.display='inline';consulta(frm,'pp');}function info_os_extrato(extrato,posto){activa("aba_os");var frm=document.getElementById('frm_os');frm.reset();$('#frm_os #os_posto').val(posto);$('#frm_os #os_outro').val("tbl_os_extra#extrato");frm.os_outro_value.value=extrato;frm.os_outro_value.style.display='inline';consulta(frm,'os');}function consulta(frm,aba){var res=$("#resultados");var post;var frm_item;post="ajax=sim&";for(i=0;i<frm.length;i++){frm_item=frm.elements[i];if(frm_item.value){if(frm_item.name.indexOf('outro')!=-1&&frm.elements[i].value.length!=0&&frm_item.type!='checkbox'){post+=frm.elements[i++].value+"="+frm.elements[i].value+"&";}else if(frm_item.name=='sql'){var sql=frm_item.value;sql=encodeURIComponent(sql);post+=frm_item.name+"="+sql+"&";}else if(frm_item.type=='checkbox'){val=(frm_item.checked)?'t':'';post+=frm_item.name+"="+val+"&";}else if(frm_item.type=='radio'){val=(frm_item.checked)?frm_item.value:'';if(val!='')post+=frm_item.name+"="+val+"&";}else{post+=frm_item.name+"="+frm_item.value+"&";}}}if(document.getElementById('usar_banco_de_testes').checked==true)post=post+'&usar_banco_de_testes=sim';if(document.getElementById('verSQL').checked==true)post=post+'&verSQL=t';post+='&limiteSQL='+$('#limiteSQL').val();post+="&acao="+aba;post+="&prg_ver=<?=$my_prg_ver?>";$.post(program_self,post,function(data){if(post.indexOf("acao=co")<0)res.html(data);$('div#sql').dialog({minWidth:150,maxHeight:400});if(post.indexOf("acao=sq")>0&&data.indexOf("sqlres")>0){sorter.head='head';sorter.asc='asc';sorter.desc='desc';sorter.even='evenrow';sorter.odd='oddrow';sorter.evensel='evenselected';sorter.oddsel='oddselected';sorter.paginate=(data.indexOf('"navigation"')>0),sorter.pagesize=20;sorter.currentid='currentpage';sorter.limitid='pagelimit';sorter.init('sqlres',0);}if(post.indexOf("acao=co")>0){new_config=data.split('|');posto_ini_page=new_config[1];admin_ini_page=new_config[2];if(new_config[3]=='mostrar'){$('#ico_gmail').fadeIn('normal');}else{$('#ico_gmail').hide('fast');}if(new_config[4]=='mostrar'){$('#ico_lv').fadeIn('normal');}else{$('#ico_lv').hide('fast');}if(new_config[0].indexOf('OK')){res.html('<div id="newver_msg_block" style="display:none">Configuração atualizada!<p>'+data+'</div>').find('div#newver_msg_block').fadeIn('fast').delay(1500).hide('slow');$('body').css('backgroundImage','url('+$('input[name=fundo]:checked').val()+')');activa("aba_pp",false);}}$('#resultados .os').contextMenu({menu:'os_c_menu'},function(acao,botao){var codigo_posto=$(botao).attr('login_posto');var senha_posto=$(botao).attr('senha_posto');var num_os=$(botao).attr('os');var fabricante=$(botao).attr('fabricante');if(acao=='consulta_os_posto'){logar_como(codigo_posto,senha_posto,urlAssist+'/os_press.php?os='+num_os);}if(acao=='consulta_os_admin'){logar_como(fabricante,'mlg_pedir_login',urlAssist+'/admin/os_press.php?os='+num_os);}if(acao=='os_item_new_posto'){logar_como(codigo_posto,senha_posto,urlAssist+'/os_item.php?os='+num_os);}if(acao=='upload_os'){logar_como(fabricante,'mlg_pedir_login',urlAssist+'/admin/nota_foto_cadastro.php');}if(acao=='os_item_new_admin'){logar_como(fabricante,'mlg_pedir_login',urlAssist+'/admin/os_item.php?os='+num_os);}});$('#resultados .pp').contextMenu({menu:'pp_c_menu'},function(acao,botao){var codigo_posto=$(botao).attr('login_posto');var senha_posto=$(botao).attr('senha_posto');var fabricante=$(botao).attr('fabricante');if(acao=='logar_posto'){logar_como(codigo_posto,senha_posto,'');}if(acao=='logar_admin'){logar_como(fabricante,'mlg_pedir_login','');}});$('#resultados .ad').contextMenu({menu:'ad_c_menu'},function(acao,botao){var login_admin=$(botao).attr('login_admin');var senha_admin=$(botao).attr('senha_admin');var fabricante=$(botao).attr('fabricante');if(acao=='loga_ususario'){logar_como(login_admin,senha_admin,'');}if(acao=='logar_admin'){logar_como(fabricante,'mlg_pedir_login','');}});$('#resultados ul .ex').contextMenu({menu:'ex_c_menu'},function(acao,botao){var codigo_posto=$(botao).attr('login_posto');var senha_posto=$(botao).attr('senha_posto');var extrato=$(botao).attr('extrato');var posto=$(botao).attr('posto');var fabricante=$(botao).attr('fabricante');if(acao=='consulta_extrato_posto'){logar_como(codigo_posto,senha_posto,urlAssist+'/os_extrato.php?extrato='+extrato+'&posto='+posto);}if(acao=='consulta_extrato_admin'&&fabricante=='Bosch'){logar_como(fabricante,'mlg_pedir_login',urlAssist+'/admin/extrato_os_aprova.php?extrato='+extrato);}else if(acao=='consulta_extrato_admin'){var url_ex=urlAssist+"/admin/extrato_consulta_os";if(fabricante=='Intelbras')url_ex+='_intelbras';logar_como(fabricante,'mlg_pedir_login',url_ex+'.php?extrato='+extrato);}if(acao=='consulta_os_extrato'){info_os_extrato(extrato);}});$('#resultados ul .pd').contextMenu({menu:'pd_c_menu'},function(acao,botao){var codigo_posto=$(botao).attr('login_posto');var senha_posto=$(botao).attr('senha_posto');var pedido=$(botao).attr('pedido');var posto=$(botao).attr('posto');var fabricante=$(botao).attr('fabricante');if(acao=='consulta_pedido_posto'){logar_como(codigo_posto,senha_posto,urlAssist+'/pedido_finalizado.php?pedido='+pedido);}if(acao=='consulta_pedido_admin'){logar_como(fabricante,'mlg_pedir_login',urlAssist+'/admin/pedido_admin_consulta.php?pedido='+pedido);}});$('#resultados ul button, #resultados ul .button').addClass('small').addClass('cyan');$('.excluir').click(function(){var arquivo=$(this).attr('alt');if(arquivo==undefined)return false;if((window.confirm('<?=ttext($a_trad,'msg_excluir_confirm')?>'))&&arquivo.length>0){$.post(program_self,{'ajax':'sim','acao':'sq','excluir':'arquivo','arquivo':arquivo,'prg_ver':'<?=$my_prg_ver?>'},function(data){alert(data);if(data.indexOf('sucesso')){$(this).parent().parent().hide('normal');}});}});});}function loginUnico(posto,lu){setCookie("cook_login_unico",'','/assist',-1);setCookie("cook_login_unico",lu,'','/assist');setCookie("cook_posto",posto,'','/assist');window.open(urlAssist+"/"+posto_ini_page);}function logar_como(login,senha,link){if(login=="")return false;var frm=document.getElementById('do_that');var voltar="nao";if(senha=='mlg_pedir_login'){if(frm.logado.value!="si"){senha1=prompt("Digite seu login");senha2=prompt("Digite sua senha");}else{senha1=frm.user.value;senha2=frm.pass.value;}if(senha1!=""&&senha2!=""){senha=senha1+"|"+senha2;}else{return false;}}if(senha=="mlg_logar"){var user_pass=login.split("|");var voltar=(link.length>1)?"nao":"sim";login=user_pass[0];senha=user_pass[1];}setCookie("cook_master",'','','/assist');setCookie("cook_admin",'','','/assist');setCookie("cook_login_fabrica",'','','/assist');setCookie("cook_login_codigo_posto",'','','/assist');setCookie("cook_posto",'','','/assist');setCookie("cook_login_unico",'','','/assist');setCookie("cook_cliente_admin",'','','/assist');setCookie("cook_cliente_admin_master",'','','/assist');var url=urlAssist+"/index.php?ajax=sim&acao=validar";var post="login="+login+"&senha="+senha;$.post(url,post,function(data){var response=data.split("|");if(response.length>0){tela=response[1];if(posto_ini_page!=''||admin_ini_page!=''){if(tela.indexOf('admin')>=0&&admin_ini_page!='')tela=admin_ini_page;if(tela.indexOf('admin')==-1&&posto_ini_page!='')tela=posto_ini_page;}url=(link.length>1)?link:urlAssist+"/"+tela;if(response[0]=="ok"){if(voltar=="sim"){$('#login').hide();document.getElementById('acao_select').style.display="inline";document.getElementById('acao_logado').style.display="inline";$('#logado').val("si");$('#showuser').html(login);frm.user.readonly="READONLY";frm.pass.readonly="READONLY";activa("aba_pp",false);}else{window.open(url);}}else{if(voltar=="sim"){frm.user.value="";frm.pass.value="";}alert(response[1]);}}});}