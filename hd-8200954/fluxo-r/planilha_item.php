<?include 'dbconfig.php';include 'includes/dbconnect-inc.php';include "autentica_usuario.php";$aba=3;include "cabecalho.php";?><script>function createRequestObject(){	var request_;	var browser = navigator.appName;	if(browser == "Microsoft Internet Explorer"){		 request_ = new ActiveXObject("Microsoft.XMLHTTP");	}else{		 request_ = new XMLHttpRequest();	}	return request_;}var http_forn = new Array();function gravar(formulatio,redireciona,pagina,janela) {	var acao = 'gravar';	url = "<?=$PHP_SELF?>?ajax=sim&acao="+acao;	parametros = "";	for( var i = 0 ; i < formulatio.length; i++ ){		if (formulatio.elements[i].type !='button'){			//alert(formulatio.elements[i].name+' = '+formulatio.elements[i].value);			if(formulatio.elements[i].type=='radio' || formulatio.elements[i].type=='checkbox'){								if(formulatio.elements[i].checked == true){//					alert(formulatio.elements[i].value);					parametros = parametros+"&"+formulatio.elements[i].name+"="+escape(formulatio.elements[i].value);				}			}else{				parametros = parametros+"&"+formulatio.elements[i].name+"="+escape(formulatio.elements[i].value);			}		}	}	var com       = document.getElementById('erro');	var saida     = document.getElementById('saida');	com.innerHTML = "&nbsp;&nbsp;Aguarde...&nbsp;&nbsp;<br><img src='imagens/carregar2.gif' >";	saida.innerHTML = "&nbsp;&nbsp;Aguarde...&nbsp;&nbsp;<br><img src='imagens/carregar2.gif' >";	var curDateTime = new Date();	http_forn[curDateTime] = createRequestObject();	http_forn[curDateTime].open('POST',url,true);		http_forn[curDateTime].setRequestHeader("Content-type", "application/x-www-form-urlencoded");	http_forn[curDateTime].setRequestHeader("CharSet", "ISO-8859-1");	http_forn[curDateTime].setRequestHeader("Content-length", url.length);	http_forn[curDateTime].setRequestHeader("Connection", "close");	http_forn[curDateTime].onreadystatechange = function(){		if (http_forn[curDateTime].readyState == 4){			if (http_forn[curDateTime].status == 200 || http_forn[curDateTime].status == 304){			//alert(http_forn[curDateTime].responseText);			var response = http_forn[curDateTime].responseText.split("|");				if (response[0]=="debug"){					alert(http_forn[curDateTime].responseText);				}				if (response[0]=="ok"){					com.style.visibility = "hidden";					com.innerHTML = response[1];					saida.innerHTML = response[1];					if (document.getElementById('btn_continuar')){						document.getElementById('btn_continuar').style.display='inline';					}					formulatio.btn_acao.value='Gravar';					for( var i = 0 ; i < formulatio.length; i++ ){						if (formulatio.elements[i].type !='button'){							if(formulatio.elements[i].type=='radio' || formulatio.elements[i].type=='checkbox'){								if(formulatio.elements[i].checked == true){									formulatio.elements[i].checked=false;								}							}else{								formulatio.elements[i].value='';							}						}					}					//window.location="rg_planilha_print.php?tecnico="+response[2];				}else{					formulatio.btn_acao.value='Gravar';				}				if (response[0]=="1"){					com.style.visibility = "visible";					saida.innerHTML = "<font color='#990000'>Ocorreu um erro, verifique!</font>";					com.innerHTML = response[1];					formulatio.btn_acao.value='Gravar';				}			}		}	}	http_forn[curDateTime].send(parametros);}</script><script type="text/javascript" src="js/jquery.js"></script><script type="text/javascript" src="js/jquery.maskedinput.js"></script><script type='text/javascript' src='js/jquery.autocomplete.js'></script><link type="text/css" rel="stylesheet" href="js/jquery.autocomplete.css"><script type='text/javascript' src='js/jquery.bgiframe.min.js'></script><script type='text/javascript' src='js/dimensions.js'></script><script language="JavaScript">$().ready(function() {	function formatItem(row) {		return row[3];	}		function formatResult(row) {		alert(row[0]);		return row[0];			}		/* Busca pelo Nome */	$("input[@rel='referencia']").autocomplete("<?echo 'pesquisa.php?tipo=peca&busca=referencia&produto=';?>"+document.getElementById('produto').value, {		minChars: 3,		delay: 150,		width: 350,		matchContains: true,		highlightItem: false,		formatItem: formatItem,		formatResult: function(row) {return row[1];}	});	$("input[@rel='referencia']").result(function(event, data, formatted) {		$("input[@name=peca]").val(data[0])    ;		$("input[@name=descricao]").val(data[2]) ;		//$("input[@name=serie_"+$(this).attr("alt")+"]").focus()           ;	});	/* Busca pelo Nome */	$("input[@rel='descricao']").autocomplete("<?echo 'pesquisa.php?tipo=peca&busca=descricao&produto=';?>"+document.getElementById('produto').value, {		minChars: 3,		delay: 150,		width: 350,		matchContains: true,		highlightItem: false,		formatItem: formatItem,		formatResult: function(row) {return row[2];}	});	$("input[@rel='descricao']").result(function(event, data, formatted) {		$("input[@name=peca]").val(data[0])    ;		$("input[@name=referencia]").val(data[1]) ;		//$("input[@name=serie_"+$(this).attr("alt")+"]").focus()           ;	});});function marcar(){	$("input[@rel='check']").each(function(){		this.checked = !this.checked;	});}</script><?$sql = "SELECT  RI.rg                               ,				PR.produto                          ,				PR.linha                            ,				PR.familia                          ,				PR.descricao   AS produto_descricao ,				PR.referencia  AS produto_referencia,				RI.defeito_reclamado                ,				DC.descricao   AS defeito_constatado		FROM   tbl_produto_rg         RG 		JOIN   tbl_produto_rg_item    RI USING(produto_rg)		JOIN   tbl_produto            PR USING(produto)		JOIn   tbl_defeito_constatado DC USING(defeito_constatado)		WHERE  RG.posto           = $login_posto		AND    RI.produto_rg_item = $id ; ";$res = pg_exec($con,$sql);if(pg_numrows($res)>0){	$produto = pg_result($res,0,produto);	$produto_referencia = pg_result($res,0,produto_referencia);	$produto_descricao  = pg_result($res,0,produto_descricao);	$defeito_reclamado  = pg_result($res,0,defeito_reclamado);	$defeito_constatado = pg_result($res,0,defeito_constatado);}?><div id="m_1" class="modbox">	<h2 class="modtitle">		<div id="m_1_h">			<span id="m_1_title" class="modtitle_text"><font color="#005f9d">Lançamento de Itens na OS</font></span>		</div>	</h2>	<div id="m_1_b" class="modboxin">		<div id="ftl_1_0" class="uftl" style='text-align:justify'>			<form name="frm_os" method="post"  onsubmit="return false">				<input type='hidden' name='produto' id='produto' value='<?=$produto?>'  class='Caixa'>				<table  align='center'  border='0' class='TabelaRevenda' cellspacing='0' cellpadding='0' width='700'>					<caption>Informação da OS</caption>					<tr>						<th>OS</th>						<th>Produto</th>						<th>Defeito Constatado</th>						<th>Defeito Reclamado</th>					</tr>					<tr>						<td><? echo "$sua_os";?></td>						<td><? echo "$produto_referencia - $produto_descricao";?></td>						<td><? echo "$defeito_constatado";?></td>						<td><? echo "$defeito_reclamado";?></td>					</tr>				</table>				<table  align='center'  border='0' class='TabelaRevenda' cellspacing='0' cellpadding='0' width='700'>					<caption>Adicionar Peça a OS</caption>					<tr>						<th>Referência</th>						<td>							<input type='hidden' name='peca' id='peca' value='<?=$peca?>'  class='Caixa'>							<input type='text' name='referencia' id='referencia' rel='referencia' value='<?=$referencia?>' size='15' class='Caixa'>						</td>						<th>Descrição</th>						<td><input type='text' name='descricao'  id='descricao' rel='descricao' value='<?=$descricao?>' size='40' class='Caixa'></td>						<td>							<input type='radio' name='tipo' id='tipo' value='estoque'> Peça do estoque<br>							<input type='radio' name='tipo' id='tipo' value='aguardando'> Aguardando Peça						</td>						<td><input type='button' value='Gravar'></td>					</tr>				</table>			</form>			<div id='erro' style='visibility:hidden;opacity:0.85' class='Erro'></div>		</div>	</div></div><?include "rodape.php";?>