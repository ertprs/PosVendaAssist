<?php
include dirname(__FILE__) . '/../../dbconfig.php';
include dirname(__FILE__) . '/../../includes/dbconnect-inc.php';
include dirname(__FILE__) . '/../funcoes.php';
include dirname(__FILE__) . '/../../class/email/mailer/class.phpmailer.php';
include dirname(__FILE__) .'/../../admin/rocketchat_api.php';
include dirname(__FILE__) .'/../../class/communicator.class.php';
$mail = new TcComm();

$login_fabrica = 50;
$fabrica_nome  = 'colormaq';


$alsk = array(
                "09098163000123",
                "13840609000110",
                "25048712000101",
                "03497215000158",
                "12087004000138",
                "15102363000105",
                "13632544000118",
                "13931062000169",
                "15237052000153",
                "25311719000174",
                "17176320000108",
                "05485385000148",
                "26325619000160",
                "17947120000101",
                "17352742000189",
                "21153542000174",
                "24579188000132",
                "17566314000159",
                "05863659000195",
                "10936712000170",
                "40474165000110",
                "09293829000102",
                "04770424000196",
                "13294254000101",
                "34261008000123",
                "21258756000105",
                "00356952000142",
                "13846365000183",
                "33852468000163",
                "13932885000109",
                "63231104000127",
                "21237933000177",
                "13474053000196",
                "05687155000161",
                "23783945000122",
                "02258992000187",
                "19841135000108",
                "22023259000190",
                "00121133000116",
                "09477998000194",
                "07473057000157",
                "11921860000184",
                "11926593000138",
                "23547044000131",
                "18865430000131",
                "14322808000108",
                "03460858000127",
                "11669334000179",
                "04921971000125",
                "10332754000100",
                "25329352000116",
                "13802996000109",
                "00654237000196",
                "00473210000105",
                "03256101000116",
                "03207606000190",
                "16324014000109",
                "11492779000126",
                "15794049000130",
                "25499624000126",
                "22257396000190",
                "11989636000124",
                "20648666000168",
                "19448277000100",
                "07333192000105",
                "23702656000151",
                "24858568000106",
                "42062604000102",
                "21487093000109",
                "74074287000130",
                "34217653000149",
                "12852637000195",
                "18645189000135",
                "00096051000169",
                "07473057000238",
                "10796684000133",
                "15721703000186",
                "34217653000220",
                "24405840000100",
                "06086956000134",
                "07479521000112",
                "19001290000116",
                "13518419000181",
                "13682691000100",
                "11200725000140",
                "10707626000196",
                "06188215000164",
                "07883877000117",
                "20045271000170",
                "63207781000100",
                "16703243000126",
                "15296128000111",
                "02262165000167",
                "10338217000160",
                "04479347000110",
                "01534364000114",
                "14579255000165",
                "14690887000100",
                "13065102000137",
                "21568972000157",
                "13491097000124",
                "02012511000159",
                "18856768000127",
                "25259892000170",
                "00569760000114",
                "14783528000199",
                "10257279000147",
                "21516397000149",
                "07105950000120",
                "19321832000138",
                "86818275000152",
                "11646914000140",
                "35236389000153",
                "12621743000249",
                "12621743000168",
                "05672183000105",
                "02886656000189",
                "00148439000166",
                "16924653000105",
                "21507893000136",
                "26090805000167",
                "01635750000100",
                "11494839000140",
                "12312971000156",
                "21914408000149",
                "07086826000164",
                "06037840000105",
                "25153335000170",
                "08104044000173",
                "09196814000118",
                "08820291000176",
                "07654320000104",
                "12254496000109",
                "20514373000279",
                "00620791000152",
                "07681190000107",
                "13389370000104",
                "14218062000189",
                "04862855000182",
                "02247998000159",
                "23170013000104",
                "11380434000180",
                "22774284000106",
                "22078153000194",
                "15614012000183",
                "13721862000155",
                "00645221000117",
                "03865902000189",
                "08172651000170",
                "28417343000175",
                "15277533000192",
                "19081388000120",
                "20399743000193",
                "14620187000130",
                "09023138000180",
                "16515791000122",
                "14231536000122",
                "14024703000164",
                "08990662000168",
                "07027890000174",
                "36408854000159",
                "07685822000100",
                "11317263000145",
                "10869891000170",
                "18582933000108",
                "10145292000104",
                "13413106000169",
                "32395063000180",
                "03112131000159",
                "11254033000184",
                "2004758000196",
                "15175398000174",
                "09646689000109",
                "02940578000153",
                "24570450000188",
                "12390404000118",
                "00872191000181",
                "39825708000117",
                "27754589000170",
                "10622748000180",
                "02689235000168",
                "13598887000103",
                "15333825000103",
                "05648710000146",
                "16678390000193",
                "00056810000160",
                "23591963000102",
                "37258514000151",
                "18780415000190",
                "15019963000104",
                "03290236000106",
                "21446486000166",
                "09607307000120",
                "06341930000195",
                "24157904000193",
                "06305119000159",
                "17428496000100",
                "11082675000143",
                "19472169000172",
                "26069198000153",
                "04821686000132",
                "26547240000102",
                "06563345000130",
                "02997048000141",
                "02420446000109",
                "15501359000110",
                "04313731000148",
                "17991887000120",
                "01154111000115",
                "25286027000113",
                "07200498000185",
                "09010027000130",
                "26502114000123",
                "23960683000124",
                "11749593000100",
                "37346996000100",
                "14698570000101",
                "06948836000107",
                "05888347000136",
                "13961352000155",
                "04421260000191",
                "11422811000105",
                "09205492000126",
                "13843319000120",
                "25127523000124",
                "15283171000142",
                "07776299000110",
                "14921108000121",
                "15049179000149",
                "26073560000160",
                "22116751000100",
                "04303770000164",
                "03876160000197",
                "25022449000181",
                "20168511000124",
                "01264496000173",
                "10280547000141",
                "20862993000118",
                "07884840000103",
                "12243935000188",
                "03717949000103",
                "11757398000121",
                "21996461000136",
                "04566986000112",
                "17226095000169",
                "22572383000105",
                "15660917000190",
                "06246499000106",
                "22219705000137",
                "12360276000160",
                "01200350000164",
                "03839537000138",
                "18553760000191",
                "17605045000192",
                "18568914000119",
                "04035251000162",
                "15639424000178",
                "06179793000134",
                "18645244000197",
                "13139034000103",
                "19270113000135",
                "00485000000129",
                "14421053000190",
                "22466964000162",
                "00062882000110",
                "20787491000170",
                "12387998000108",
                "03759320000118",
                "20173531000193",
                "09262377000193",
                "07909208000177",
                "14078305000120",
                "06862627001290",
                "25535664000186",
                "15402187000127",
                "20816677000100",
                "18566342000139",
                "12609496000184",
                "04098717000179",
                "25968441000102",
                "10355139000101",
                "12251482000131",
                "14588539000118",
                "01772759000155",
                "09220650000117",
                "10892363000132",
                "10353027000111",
                "20129140000171",
                "09262377000274",
                "19311666000199",
                "11819410000185",
                "21018634000141",
                "20425015000109",
                "15237272000187",
                "15707567000170",
                "18536304000133",
                "24732452000126",
                "19153753000165",
                "05329094000160",
                "11856924000100",
                "26593491000115",
                "01985175000168",
                "16855635000100",
                "07430962000120",
                "06112046000189",
                "22360331000175",
                "70496294000170",
                "04028124000136",
                "22707176000110",
                "07093235000114",
                "08746070000103",
                "97549053000106",
                "23012209000170",
                "09341597000102",
                "36956639000192",
                "06968244000149",
                "12529247000189",
                "09145331000194",
                "12194426000102",
                "03147899000168",
                "73773434000106",
                "00183640000184",
                "03936093000230",
                "14339713000199",
                "07690246000181",
                "09140299000154",
                "08515901000128",
                "23157323000199",
                "22436502000100",
                "13987980000100",
                "03857712000110",
                "19283843000170",
                "13440317000190",
                "13265420000141",
                "24039585000111",
                "12409288000131",
                "37200979000151",
                "01712061000144",
                "74037011000182",
                "08582667000151",
                "13365546000198",
                "05016259000144",
                "01551472000103",
                "12302761000187",
                "22825950000198",
                "15506762000131",
                "03681263000100",
                "03490398000180",
                "16607295000107",
                "11561109000114",
                "18841918000129",
                "13383159000184",
                "38478160000113",
                "10309372000158",
                "09598352000165",
                "17333741000197",
                "17657149000140",
                "26391242000147",
                "04732674000131",
                "20613246000146",
                "02433327000182",
                "71464929000110",
                "16996535000102",
                "71216618000131",
                "20488785000109",
                "65285421000151",
                "09558946000142",
                "05697716000103",
                "13101125000150",
                "10994773000194",
                "10517733000151",
                "21818485000103",
                "08432235000164",
                "23128143000189",
                "07640803000150",
                "09185098000173",
                "11768121000102",
                "17830076000147",
                "86607082000152",
                "06293920000121",
                "12734785000105",
                "71054969000193",
                "07477964000174",
                "18339447000155",
                "19461895000190",
                "13605075000148",
                "08998303000157",
                "68536507000106",
                "00324214000113",
                "21432455000156",
                "08003157000182",
                "12027436000153",
                "04633091000153",
                "18000908000160",
                "12340976000192",
                "20390915000168",
                "26260562000168",
                "14585785000116",
                "02166099000121",
                "01870522000107",
                "05369911000104",
                "10925120000153",
                "04528994000174",
                "41687302000167",
                "21101755000152",
                "15739163000168",
                "18150726000176",
                "00731785000172",
                "11424719000176",
                "23311131000195",
                "25314949000197",
                "23150626000180",
                "08712221000102",
                "17074303000151",
                "05694020000123",
                "05629581000149",
                "16663817000180",
                "17016074000119",
                "01452173000103",
                "14523603000182",
                "13400733000165",
                "18987743000162",
                "19387232000172",
                "04535185000190",
                "23150188000150",
                "13515815000155",
                "07718171000108",
                "02025700000166",
                "21062354000130",
                "21712420000170",
                "03697385000186",
                "09291918000101",
                "07068963000176",
                "02915626000153",
                "11309822000175",
                "05869529000160",
                "11378785000157",
                "08828835000146",
                "21808423000102",
                "22308308000131",
                "08656701000195",
                "19674284000120",
                "18263271000103",
                "09198619000127",
                "71419824000149",
                "03710691000105",
                "06207910000126",
                "15097776000149",
                "04448358000132",
                "01499229000185",
                "00364404000164",
                "07816748000106",
                "00477248000148",
                "01232798000160",
                "19066177000119",
                "23048356000109",
                "08856186000197",
                "06100445000120",
                "11327856000192",
                "07463443000168",
                "17464031000104",
                "07117025000119",
                "23227432000135",
                "18108530000113",
                "71360960000291",
                "03224303000186",
                "21717921000140",
                "16622298000101",
                "05032150000109",
                "01478933000151",
                "15422110000119",
                "03254568000127",
                "71364632000182",
                "13688342000198",
                "17548816000157",
                "20775284000103",
                "26307533000104",
                "22744536000154",
                "09335261000137",
                "00976327000101",
                "25877028000132",
                "25475492000100",
                "03848946000109",
                "08584756000137",
                "86382744000133",
                "18607697000129",
                "11520060000151",
                "12478757000174",
                "16737750000180",
                "18378897000157",
                "12510555000162",
                "04049497003966",
                "04184360000141",
                "14957638000120",
                "20797587000119",
                "14379116000198",
                "23688731000177",
                "22759189000133",
                "11279851000131",
                "12023429000183",
                "11480331000192",
                "16719899000137",
                "24492596000152",
                "03803972000102",
                "10280439000179",
                "34662023000183",
                "21645065000164",
                "20974738000167",
                "83332676000100",
                "10403098000181",
                "13389370000104",
                "10789742000100",
                "16605937000120",
                "02582565000150",
                "22913560000170",
                "40972739000180",
                "40982464000165",
                "17206133000111",
                "13756759000140",
                "18938806000190",
                "09314728000162",
                "12057525000142",
                "15091666000170",
                "14264935000190",
                "03925210000189",
                "07154129000101",
                "07546782000108",
                "10951487000141",
                "01939442000160",
                "17331409000193",
                "06184765000105",
                "80848690000172",
                "11305277000149",
                "18618901000107",
                "80325178000141",
                "82584632000104",
                "04947853000196",
                "07007635000160",
                "20336120000171",
                "20954959000173",
                "24692218000112",
                "20878212000183",
                "14157484000191",
                "82331646000116",
                "06310697000183",
                "04072642000157",
                "08903904000139",
                "79084901000169",
                "18361866000193",
                "10900415000175",
                "03256347000198",
                "77495521000191",
                "24782563000147",
                "12549522000126",
                "82031832000130",
                "26600087000121",
                "06994244000113",
                "08747414000190",
                "22609807000169",
                "18581674000192",
                "75986026000311",
                "11163291000155",
                "11069139000108",
                "03203009000198",
                "82431750000182",
                "01820801000166",
                "09114979000101",
                "06137573000148",
                "08710765000127",
                "00813778000110",
                "79738423000163",
                "21824048000194",
                "13817649000141",
                "22183447000186",
                "75518712000104",
                "14741355000146",
                "12534167000111",
                "21912145000139",
                "72353998000119",
                "00751044000153",
                "10996829000140",
                "17450425000103",
                "04726061000191",
                "09320403000192",
                "72495468000105",
                "07530243000180",
                "12938406000107",
                "75315952000101",
                "00814555000177",
                "08365274000196",
                "15390961000127",
                "72461361000146",
                "15006891000160",
                "08965231000141",
                "24894435000195",
                "15019372000137",
                "09067300000162",
                "82335621000190",
                "13366698000105",
                "19163382000100",
                "17694593000136",
                "18512492000160",
                "77427979000103",
                "10878121000194",
                "80820418000184",
                "13652836000112",
                "11542827000143",
                "12058847000106",
                "09589996000197",
                "07445426000106",
                "16816251000189",
                "22319038000164",
                "03657837000104",
                "09237007000104",
                "17775042000105",
                "22649656000172",
                "16650760000184",
                "05687370000162",
                "14970930000182",
                "07196480000157",
                "13875576000144",
                "00140383000101",
                "08145648000168",
                "14462481000161",
                "09099963000169",
                "19672281000157",
                "11123303000118",
                "09043866000154",
                "17414059000129",
                "19538492000100",
                "17611979000137",
                "02016730000106",
                "75986026000150",
                "03961334000110",
                "75690578000116",
                "81430522000125",
                "00814834000130",
                "02811037000125",
                "10330946000170",
                "02811046000116",
                "19430189000180",
                "23479018000113",
                "08111921000133",
                "12844898000163",
                "11249716000143",
                "11975789000112",
                "26543200000184",
                "00812176000148",
                "08022127000113",
                "19498899000142",
                "22670068000110",
                "18019880000103",
                "08861446000112",
                "16871629000147",
                "11777944000196",
                "03225860000111",
                "12584569000120",
                "08104044000173",
                "13259872000110",
                "17599752000113",
                "09207967000113",
                "22634754000136",
                "12618285000108",
                "19755571000164",
                "06050386000122",
                "12907563000147",
                "12549624000141",
                "08673070000112",
                "09118005000198",
                "07943578000120",
                "07808646000149",
                "15712779000145",
                "06730238000159",
                "02629256000198",
                "00881053000169",
                "08091004000134",
                "22326149000106",
                "69625739000195",
                "17712387000101",
                "11188031000134",
                "10711887000180",
                "03619192000107",
                "04845498000144",
                "13062941000100",
                "17733512000160",
                "09359478000187",
                "36205813000165",
                "29323268000146",
                "22063128000137",
                "26041692000100",
                "07972688000110",
                "11530694000195",
                "21025427000114",
                "23762969000103",
                "29396124000110",
                "13335206000114",
                "12956621000122",
                "36546919000122",
                "21881563000106",
                "31534530000143",
                "18260546000147",
                "18291538000168",
                "86972767000106",
                "06369702000395",
                "11990365000127",
                "23402900000160",
                "14685403000126",
                "26037736000128",
                "01150923000192",
                "22992864000170",
                "25063788000106",
                "24682454000158",
                "23473376000119",
                "23098390000180",
                "11881691000104",
                "18095012000102",
                "19248769000151",
                "22572286000112",
                "70143425000135",
                "15383022000155",
                "13371263000159",
                "17871507000113",
                "04732200000190",
                "13363760000105",
                "12406025000179",
                "08151920000112",
                "18641515000136",
                "09235627000104",
                "01094833000121",
                "10412074000199",
                "02032853000130",
                "13119446000181",
                "20598992000108",
                "03697001000125",
                "14889788000143",
                "9451991000157",
                "11604046000136",
                "00844109000105",
                "14927591000151",
                "01308682000167",
                "15540682000100",
                "13497767000110",
                "74708454000158",
                "08716484000181",
                "00462357000191",
                "93693810000151",
                "19299802000172",
                "92335025000164",
                "03345364000100",
                "90067125000121",
                "04796565000188",
                "07234017000152",
                "15383022000155",
                "89620595000191",
                "89101430000103",
                "08379707000162",
                "94980265000147",
                "17833049000128",
                "10486661000122",
                "18350576000144",
                "06249434000106",
                "15065629000197",
                "00582299000130",
                "11181068000130",
                "90718404000108",
                "08426675000109",
                "12436380000190",
                "22396585000143",
                "12150475000143",
                "20482177000189",
                "25957802000115",
                "02307659000110",
                "93600492000137",
                "87593554000128",
                "06276765000135",
                "16831206000101",
                "92488600000169",
                "97392526000104",
                "11002434000147",
                "10338558000135",
                "04034628000169",
                "06127601000146",
                "15070627000196",
                "22691428000160",
                "08593227000108",
                "89934814000107",
                "07290443000103",
                "11029540000114",
                "89368559000182",
                "93953602000144",
                "23068560000183",
                "06136400000105",
                "17036697000153",
                "03046026000169",
                "05829885000150",
                "18680206000175",
                "92669613000134",
                "15550037000160",
                "04375375000197",
                "92573666000157",
                "07119727000131",
                "00482390000183",
                "08516067000195",
                "94299468000172",
                "10892543000114",
                "74779356000101",
                "13012996000105",
                "21876281000110",
                "22217438000169",
                "17576485000169",
                "90213471000170",
                "14505488000113",
                "90411505000131",
                "94486438000175",
                "00972179000149",
                "25366952000154",
                "01983484000107",
                "01983484000107",
                "11646138000189",
                "92133651000178",
                "74859034000172",
                "03109213000144",
                "10463729000158",
                "12120661000130",
                "93822443000149",
                "04562391000199",
                "88060710000158",
                "93917987000194",
                "08338033000158",
                "09031484000100",
                "19657108000180",
                "22723892000191",
                "17802461000180",
                "16844140000186",
                "91013714000190",
                "92571892000107",
                "19676143000146",
                "17347061000122",
                "92567668000133",
                "24876610000111",
                "08469435000191",
                "21204710000103",
                "17996333000115",
                "08422475000188",
                "19252583000176",
                "87805164000174",
                "90232398000184",
                "14899919000173",
                "03286716000195",
                "19691850000101",
                "09432424000108",
                "25068227000108",
                "03512723000168",
                "10723008000130",
                "14557692000188",
                "09640070000189",
                "08603066000188",
                "10275343000112",
                "19922595000160",
                "03613697000164",
                "15898679000155",
                "10723008000210",
                "15609838000154",
                "08384988000141",
                "85320810000188",
                "85140838000133",
                "17386226000175",
                "73425092000125",
                "76861848000177",
                "12981173000117",
                "24074282000130",
                "03049358000105",
                "13773182000185",
                "13528826000170",
                "78220720000150",
                "81866592000120",
                "18513891000145",
                "21703898000134",
                "02096596000109",
                "10296319000160",
                "13911767000114",
                "18959733000113",
                "11843531000162",
                "76321215000176",
                "04886936000112",
                "05062704000102",
                "12983801000101",
                "17553244000102",
                "11886680000109",
                "24285349000185",
                "00118341000166",
                "05799649000138",
                "17650226000130",
                "27005488000104",
                "13413478000276",
                "15226946000148",
                "14721297000199",
                "24823278000127",
                "15065367000160",
                "02404308000128",
                "06217621000108",
                "94596798000120",
                "14148739000150",
                "10713665000104",
                "81367831000106",
                "07982848000102",
                "11988453000194",
                "08825365000167",
                "07540151000181",
                "82856923000104",
                "06997065000130",
                "22481464000108",
                "11194657000153",
                "07035923000128",
                "14953075000100",
                "09499535000123",
                "17716944000162",
                "18147016000197",
                "00714388000192",
                "17305141000115",
                "12352786000195",
                "13582308000134",
                "19615651000114",
                "21289349000165",
                "81387995000197",
                "95829628000100",
                "16837470000144",
                "15076023000157",
                "06968584000170",
                "26241342000197",
                "07237409000175",
                "06159626000121",
                "01642847000132",
                "80754773000100",
                "08263447000165",
                "07561495000258",
                "79299608000119",
                "04142427000185",
                "95792982000108",
                "19498315000139",
                "07688631000194",
                "82094186000150",
                "11728950000153",
                "23809947000143",
                "02012347000180",
                "76573997000211",
                "82718842000148",
                "04690407000149",
                "02574300000100",
                "08785009000167",
                "12132276000102",
                "09284804000134",
                "13265367000189",
                "00760445000170",
                "22953169000107",
                "21727734000147",
                "23184422000160",
                "13111835000160",
                "02861202000153",
                "23730335000160",
                "61783478000120",
                "26676327000171",
                "18061604000103",
                "21109332000189",
                "21109332000189",
                "03483289000135",
                "55220693000110",
                "07702691000114",
                "19425835000111",
                "59147454000132",
                "10446919000167",
                "96341490000169",
                "67577536000145",
                "23375976000144",
                "23375976000144",
                "20378991000158",
                "52307923000275",
                "15718602000156",
                "39052048000189",
                "01862129000171",
                "12158284000128",
                "10696503000105",
                "09509909000144",
                "11377677000160",
                "16564184000152",
                "52212594000106",
                "54829791000196",
                "05797470000141",
                "38759015000100",
                "13765869000179",
                "21611901000190",
                "05936363000157",
                "59071563000113",
                "09200875000101",
                "12436230000187",
                "05017965000100",
                "09115581000181",
                "17398395000125",
                "21059030000143",
                "14846139000165",
                "24750782000144",
                "07677885000107",
                "54137120000164",
                "13583541000131",
                "52811346000173",
                "48198378000178",
                "16592389000141",
                "21564702000178",
                "13187803000149",
                "13187803000149",
                "13187803000149",
                "13187803000149",
                "13187803000149",
                "13187803000149",
                "13187803000149",
                "13187803000149",
                "00402287000186",
                "19312029000137",
                "14363599000132",
                "10963799000175",
                "10462635000164",
                "10462635000164",
                "10462635000164",
                "10462635000164",
                "10462635000164",
                "10462635000164",
                "10462635000164",
                "56248453000196",
                "56248453000196",
                "56248453000196",
                "56248453000196",
                "11651019000114",
                "11835037000156",
                "59495374000178",
                "23978707000172",
                "16585198000152",
                "15764825000150",
                "21454675000180",
                "52732823000105",
                "03249671000189",
                "06112894000198",
                "23615936000122",
                "07275804000142",
                "72866460000108",
                "03862546000140",
                "23443306000118",
                "59382572000125",
                "68041482000161",
                "10662044000130",
                "59143115000188",
                "11460917000195",
                "01637728000191",
                "17120519000106",
                "10807615000188",
                "12036435000175",
                "05743221000173",
                "05994951000147",
                "15299816000135",
                "07290157000148",
                "25127273000122",
                "08047071000151",
                "25385834000193",
                "24564863000150",
                "53407862000108",
                "01138831000197",
                "21074482000102",
                "07544917000104",
                "21816953000100",
                "57697880000114",
                "58245002000120",
                "22099093000196",
                "21554170000198",
                "54293428000107",
                "12540616000134",
                "11454450000170",
                "07740029000159",
                "55768832000144",
                "13330970000105",
                "14360165000189",
                "60050937000101",
                "15667002000106",
                "00273214000131",
                "03823322000129",
                "21690124000116",
                "17985042000121",
                "39004825000110",
                "11721191000105",
                "60010725000192",
                "12238469000142",
                "23594121000104",
                "71321038000104",
                "96312954000109",
                "03831597000104",
                "49591787000100",
                "09072783000193",
                "20129487000114",
                "15577320000186",
                "15700812000117",
                "64676299000181",
                "09343927000107",
                "10616651000164",
                "12369326000170",
                "17334782000106",
                "12472944000140",
                "53738993000160",
                "25192927000100",
                "10585869000107",
                "00261942000123",
                "19484066000122",
                "23408519000109",
                "03595867000125",
                "66774183000100",
                "20379931000150",
                "07940362000101",
                "07401158000112",
                "24822419000197",
                "23567384000124",
                "61610374000113",
                "13667222000104",
                "18069905000183",
                "07359293000147",
                "61082244000155",
                "55868038000172",
                "21807793000125",
                "10996895000110",
                "57913949000108",
                "45556362000100",
                "72857923000175",
                "20422741000178",
                "01034481000119",
                "18270235000169",
                "11424156000116",
                "62003363000138",
                "00385956000159",
                "58955014000149",
                "00301763000172",
                "13933302000164",
                "07471302000197",
                "14286634000167",
                "14443604000117",
                "14398991000117",
                "54882840000154",
                "07926378000160",
                "21625293000172",
                "07671799000197",
                "12749194000101",
                "09396418000134",
                "61356283000101",
                "19048258000196",
                "06098960000112",
                "12477619000170",
                "16602355000190",
                "07921580000107",
                "22082862000143",
                "14427730000188",
                "61562385000175",
                "17012387000107",
                "02969986000138",
                "18484282000105",
                "38946497000108",
                "24469526000183",
                "23415654000181",
                "45199619000105",
                "14013374000156",
                "19660344000155",
                "00574893000189",
                "47617717000140",
                "03054360000164",
                "14544491000146",
                "24940206000160",
                "12074297000119",
                "05022609000185",
                "22596764000124",
                "21833123000183",
                "24594979000131",
                "14725545000170",
                "00667670000166",
                "14284628000170",
                "13715597000100",
                "21880146000149",
                "21679001000184",
                "14856811000101",
                "39009485000110",
                "05144136000199",
                "05647559000121",
                "10526862000106",
                "16888740000146",
                "14758603000161",
                "17749217000100",
                "20274402000191",
                "19701789000136",
                "24550026000171",
                "01853461000170",
                "10243456000136",
                "54759238000124",
                "64589815000130",
                "18755088000117",
                "10721825000159",
                "09216148000132",
                "73176000000110",
                "00598355000205",
                "07144829000107",
                "20797587000119",
                "21282788000146",
                "24976236000126",
                "26104622000153",

);
$postos_login_unico_cnpj_colormaq = array();
$postos_cnpj_colormaq = array();

foreach ($alsk as $cnpj) {
    $sqlLoginUnico = "SELECT  DISTINCT
                         tbl_login_unico.nome AS name,
                         tbl_login_unico.email,
                         tbl_login_unico.posto,
                         tbl_posto_fabrica.fabrica,
                         tbl_posto_fabrica.contato_email AS contato_email,
                         tbl_posto_fabrica.fabrica AS fabrica,
                         tbl_posto_fabrica.codigo_posto AS username
                    FROM tbl_login_unico
                    JOIN tbl_posto_fabrica ON tbl_login_unico.posto = tbl_posto_fabrica.posto
                    JOIN tbl_posto ON tbl_posto.posto = tbl_posto_fabrica.posto
                   WHERE tbl_posto_fabrica.fabrica = {$login_fabrica} 
                     AND tbl_posto_fabrica.credenciamento = 'CREDENCIADO' 
                     AND tbl_login_unico.ativo='t'
                     AND tbl_posto.cnpj='$cnpj'
                ORDER BY tbl_login_unico.nome DESC;";

    $resLoginUnico = pg_query($con, $sqlLoginUnico);
    if (pg_num_rows($resLoginUnico) > 0) {
        $postos_login_unico_cnpj_colormaq[] = $cnpj; 
    } else {
        $postos_cnpj_colormaq[] = $cnpj; 
    }
}


$arr_postos  = array();
foreach ($postos_cnpj_colormaq as $cnpj) {

    $sql = "SELECT  DISTINCT
             tbl_posto.nome AS name,
             tbl_posto.email,
             tbl_posto.posto,
             tbl_posto.fone,
             tbl_posto_fabrica.contato_email AS contato_email,
             tbl_posto_fabrica.fabrica AS fabrica,
             tbl_posto_fabrica.codigo_posto AS username, 
             tbl_posto_fabrica.senha AS password 
        FROM tbl_posto
        JOIN tbl_posto_fabrica ON tbl_posto.posto = tbl_posto_fabrica.posto
        JOIN tbl_fabrica ON tbl_fabrica.fabrica = tbl_posto_fabrica.fabrica 
       WHERE tbl_posto_fabrica.fabrica = {$login_fabrica} 
         AND tbl_posto.cnpj = '$cnpj' 
    ORDER BY tbl_posto.nome DESC;";
    $res = pg_query($con, $sql);
    if (pg_num_rows($res) > 0) {
        $rows = pg_fetch_assoc($res);
        $arr_postos[] = array(
                            "posto"    => $rows['posto'],
                            "email"    => $rows['email'],
                            "name"     => $rows['name'],
                            "username" => $rows['username'],
                            "fone"     => $rows['fone'],
                            "contato_email"     => $rows['contato_email'],
                            "password" => $rows['password'],
                         );
    }
}

$posto_sem_email  = array();
$msn_erro         = array();

if (count($arr_postos) > 0) {

	$i= 0 ;
    foreach ($arr_postos as $dados) {
echo $i;
        $emails = $mail->parseEmail($dados["email"]);
        $email  = $emails[0];

        if (!empty($email)) {
            $customFields = array(
                                    "posvendaUserId"  => $dados['posto'], 
                                    "posvendUserType" => "posto",
                                 );
			sleep('1');
			$i++ ;
			if($i % 100 == 0 and $i > 99 ) sleep('30');

            $response     = postUsers($login_fabrica, $email, $dados["username"], $dados["name"], $dados["password"], "guest", $customFields);
            if (isset($response["user"]["user"]["_id"]) && !empty($response["user"]["user"]["_id"])) {
                salvaRetornoPostoFabrica($response,$dados['posto']);
            } else {
                $msn_erro['posto_fabrica'][] = $response;
            }
        } else {

            $posto_sem_email["postos"][] = array(
                                                    "posto"         => $dados['posto'],
                                                    "codigo_posto"  => $dados['username'],
                                                    "nome_posto"    => $dados['name'],
                                                    "fone"          => $dados['fone'],
                                                );

        }
    }

}

$arr_postos_login_unico  = array();

foreach ($postos_login_unico_cnpj_colormaq as $cnpj) {

    $sqlLoginUnico = "SELECT  DISTINCT
                         tbl_login_unico.nome AS name,
                         tbl_login_unico.email,
                         tbl_login_unico.posto,
                         tbl_posto_fabrica.fabrica,
                         tbl_posto_fabrica.contato_email AS contato_email,
                         tbl_posto_fabrica.fabrica AS fabrica,
                         tbl_posto_fabrica.codigo_posto AS username
                    FROM tbl_login_unico
                    JOIN tbl_posto_fabrica ON tbl_login_unico.posto = tbl_posto_fabrica.posto
                    JOIN tbl_posto ON tbl_posto.posto = tbl_posto_fabrica.posto
                   WHERE tbl_posto_fabrica.fabrica = {$login_fabrica} 
                     AND tbl_posto_fabrica.credenciamento = 'CREDENCIADO' 
                     AND tbl_login_unico.ativo='t'
                     AND tbl_posto.cnpj='$cnpj'
                ORDER BY tbl_login_unico.nome DESC;";

    $resLoginUnico = pg_query($con, $sqlLoginUnico);
    if (pg_num_rows($resLoginUnico) > 0) {
        $rowsLoginUnico = pg_fetch_assoc($resLoginUnico);
        $arr_postos_login_unico[] = array(
                            "posto"    => $rowsLoginUnico['posto'],
                            "email"    => $rowsLoginUnico['email'],
                            "name"     => $rowsLoginUnico['name'],
                            "username" => $rowsLoginUnico['username'],
                            "fone"     => $rowsLoginUnico['fone'],
                            "contato_email"     => $rowsLoginUnico['contato_email'],
                            "password" => $rowsLoginUnico['password'],
                         );
    }

}

if (count($arr_postos_login_unico) > 0) {
	$i= 0 ;
    foreach ($arr_postos_login_unico as $rowsLoginUnico) {

        $emails = $mail->parseEmail($rowsLoginUnico["email"]);
        $email  = $emails[0];

        if (!empty($email)) {

            $customFields = array(
                                    "posvendaUserId"  => $rowsLoginUnico['posto'], 
                                    "posvendUserType" => "posto",
                                 );
			sleep('1');
			$i++;
			if($i % 100  ==0 and $i > 99 ) sleep('30');
            $response     = postUsers($login_fabrica, $email, $rowsLoginUnico["username"], $rowsLoginUnico["name"], "color123", "guest", $customFields);
            if (isset($response["user"]["user"]["_id"]) && !empty($response["user"]["user"]["_id"])) {
                salvaRetornoPostoFabrica($response,$rowsLoginUnico['posto']);
            } else {
                $msn_erro['posto_login_unico'][] = $response;
            }
        }
    }
}

//Envia e-mail para admin, com a listagem de postos que não tem email cadastrado no sistema.
if (!empty($posto_sem_email)) {

    $data_log['dest'][1] = 'felipe.marttos@telecontrol.com.br';
    $data_log['dest'][3] = 'anderson@telecontrol.net.br';
    $body .= '<p style="font-family: arial ; font-size:12px ; color: #666666">Os postos listados abaixo, estão sem e-mail cadastrado, para que os postos sejam habilitados no chat online, os mesmo deveram cadastrar seus email, pois é obrigatório.</p>';
    $body .= '<table align="center" width="100%" cellpadding="2" cellspacing="2" border="0" style="font-family: arial ; font-size:12px ; color: #666666">';
    $body .= '<tr style="background-color:#3e83c9;color:#ffffff;">';
        $body .= '<th>POSTO</th>';
        $body .= '<th>CÓDIGO POSTO</th>';
        $body .= '<th align="left">NOME POSTO</th>';
        $body .= '<th>FONE</th>';
    $body .= '</tr>';
    
    $i = 0;

    foreach ($posto_sem_email["postos"] as $k_posto_sem_email => $v_posto_sem_email) {
        $zebrado = ($i % 2 == 0) ? "#ffffff" : "#eeeeee";
        $body .= '<tr style="background:'.$zebrado.'">';
            $body .= '<td align="center">'.$v_posto_sem_email['posto'].'</td>';
            $body .= '<td align="center">'.$v_posto_sem_email['codigo_posto'].'</td>';
            $body .= '<td>'.$v_posto_sem_email['nome_posto'].'</td>';
            $body .= '<td align="center">'.$v_posto_sem_email['fone'].'</td>';
        $body .= '</tr>';
        $i++;
    }

    $body .= '</table>';

    Log::envia_email($data_log, "Listagem de Postos sem e-mails cadastrados", $body);

}
//Envia e-mail com log de erro
if (!empty($msn_erro)) {

    $data_log['dest'][1] = 'felipe.marttos@telecontrol.com.br';
    $data_log['dest'][3] = 'anderson@telecontrol.net.br';

    $body2 = '<p style="font-family: arial ; font-size:12px ; color: #666666">Log de Erro.</p>';
    $body2 .= "<b>Posto por Fabrica</b><br />";
    foreach ($msn_erro['posto_fabrica'] as $key => $value) {
        foreach ($value['create_channel'] as $key2 => $value2) {
           $body2 .= "<b>Tipo de Erro:</b> ".str_replace("'", "", $value2['error_type'])."<br />";
           $body2 .= "<b>Erro:</b> ".str_replace("'", "", $value2['error'])."<br />";
        }
    }
    $body2 .= "<hr>";
    $body2 .= "<b>Login Unico</b><br />";
    foreach ($msn_erro['posto_login_unico'] as $key => $value) {
        foreach ($value['create_channel'] as $key2 => $value2) {
           $body2 .= "<b>Tipo de Erro:</b> ".str_replace("'", "", $value2['error_type'])."<br />";
           $body2 .= "<b>Erro:</b> ".str_replace("'", "", $value2['error'])."<br />";
        }
    }

    Log::envia_email($data_log, "Log de Erro - Inserção de postos no chat", $body2);
}


function salvaRetornoPostoFabrica($data = array(),$posto) {
    global $con, $login_fabrica;
    $sql = "SELECT tbl_posto_fabrica.parametros_adicionais
              FROM tbl_posto
              JOIN tbl_posto_fabrica ON tbl_posto.posto = tbl_posto_fabrica.posto
              JOIN tbl_fabrica ON tbl_fabrica.fabrica = tbl_posto_fabrica.fabrica 
             WHERE tbl_posto_fabrica.fabrica = {$login_fabrica} 
               AND tbl_posto_fabrica.posto = {$posto};";
    $res = pg_query($con, $sql);
    $parametros_adicionais = json_decode(pg_fetch_result($res, 0, parametros_adicionais), 1);

    $parametros_adicionais["rocketchat_id"] = $data["user"]["user"]["_id"];
    $parametros_adicionais["rocketchat_username"] = $data["user"]["user"]["username"];
    $parametros_adicionais["rocketchat_roles"] = $data["user"]["user"]["roles"];
    $parametros_adicionais["active"] = $data["user"]["user"]["active"];

    $pa_up = json_encode($parametros_adicionais);
    $sqlUP = "UPDATE tbl_posto_fabrica 
                 SET parametros_adicionais='$pa_up'
               WHERE fabrica = {$login_fabrica} 
                 AND posto = {$posto};";
    $resUP = pg_query($con, $sqlUP);
    if (!pg_last_error($con)) {
        return true;
    } else {
        return false;
    }

}
