<?include 'dbconfig.php';include 'includes/dbconnect-inc.php';include 'includes/funcoes.php';include '../ajax_cabecalho.php';$admin_privilegios="info_tecnica";include 'autentica_admin.php';if($_GET["ajax"] == "sim" AND $_GET["acao"] == "cadastrar"){	$promotor   = $_GET["promotor"];	$nome       = $_GET["nome"];	$email      = $_GET["email"];	$regiao     = $_GET["regiao"];	$ativo      = $_GET["ativo"];	$tipo_posto = $_GET["tipo_posto"];	if(strlen($nome)  ==0) $msg_erro = "Por favor entre com o nome do promotor";	if(strlen($email) ==0) $msg_erro = "Por favor entre com o email do promotor";	if($ativo <> 't') $ativo = 'false';	else              $ativo = 'true';	if(strlen($msg_erro)==0){		if(strlen($promotor) == 0 ){			$sql = "INSERT INTO tbl_promotor_treinamento (						nome,						telefone,						email,						regiao,						tipo_posto,						ativo,						fabrica					)VALUES(						'$nome',						'$telefone',						'$email',						'$regiao',						'$tipo_posto',						$ativo,						$login_fabrica					)";		}else{			$sql = "UPDATE tbl_promotor_treinamento SET					nome       = '$nome',					telefone   = '$telefone',					email      = '$email',					regiao     = '$regiao',					tipo_posto = '$tipo_posto',					ativo    = $ativo 				WHERE promotor_treinamento = $promotor";		}		$res = @pg_exec($sql);	}	if(strlen($msg_erro) == 0){		echo "ok|Informações gravadas com sucesso!";	}else{		echo "1|$msg_erro";	}	exit;	}if($_GET["ajax"] == "sim" AND $_GET["acao"] == "ver"){	$sql = "SELECT tbl_promotor_treinamento.*,			tbl_tipo_posto.codigo 		FROM tbl_promotor_treinamento 		JOIN tbl_tipo_posto ON tbl_tipo_posto.tipo_posto = tbl_promotor_treinamento.tipo_posto		WHERE tbl_promotor_treinamento.fabrica = $login_fabrica";	$res = @pg_exec($sql);		if (pg_numrows($res) > 0) {		$resposta  .=  "<table border='1' cellpadding='2' cellspacing='0' style='border-collapse: collapse' bordercolor='#d2e4fc'  align='center' width='900'>";		$resposta  .=  "<TR class='Titulo'  height='25'>";		$resposta  .=  "<TD background='imagens_admin/azul.gif'><b>Nome</b></TD>";		$resposta  .=  "<TD background='imagens_admin/azul.gif'><b>Email</b></TD>";		$resposta  .=  "<TD background='imagens_admin/azul.gif'><b>Região</b></TD>";		$resposta  .=  "<TD background='imagens_admin/azul.gif'><b>Escritório</b></TD>";		$resposta  .=  "<TD background='imagens_admin/azul.gif'><b>Ativo</b></TD>";		$resposta  .=  "<TD background='imagens_admin/azul.gif' ><b>Opções</b></TD>";		$resposta  .=  "</TR>";		for ($i=0; $i<pg_numrows($res); $i++){			$promotor_treinamento = trim(pg_result($res,$i,promotor_treinamento));			$nome                 = trim(pg_result($res,$i,nome))                ;			$email                = trim(pg_result($res,$i,email))               ;			$regiao               = trim(pg_result($res,$i,regiao))              ;			$ativo                = trim(pg_result($res,$i,ativo))               ;			$codigo               = trim(pg_result($res,$i,codigo))              ;			if($ativo == 't'){				$ativo   = "<img src='imagens_admin/status_verde.gif' id='img_ativo_$i'>";				$x_ativo = "Ativo";			}			else{				$ativo = "<img src='imagens_admin/status_vermelho.gif' id='img_ativo_$i'>";				$x_ativo = "Cancelado";			}			if($cor=="#F1F4FA")$cor = '#F7F5F0';			else               $cor = '#F1F4FA';			$resposta  .=  "<TR bgcolor='$cor'class='Conteudo'>";			$resposta  .=  "<TD align='left'>$nome</TD>";			$resposta  .=  "<TD align='left'>$email</TD>";			$resposta  .=  "<TD align='left'>$regiao</TD>";			$resposta  .=  "<TD align='left'>$codigo</TD>";			$resposta  .=  "<TD align='center'>$ativo $x_ativo</TD>";			if(strlen($_GET['todos'])==0) $resposta  .=  "<TD align='center'><a href='$PHP_SELF?promotor_treinamento=$promotor_treinamento'>Alterar</TD>";			$resposta  .=  "</TR>";		}		$resposta .= " </TABLE>";	}	echo "ok|".$resposta;exit;}$layout_menu = "tecnica";$title = "Promotor de Treinamento";include "cabecalho.php";?><style>.Titulo {	text-align: center;	font-family: Verdana;	font-size: 12px;	font-weight: bold;	color: #FFFFFF;	background-color: #6699CC;}.Subtitulo {	text-align: center;	font-family: Verdana;	font-size: 10px;	font-weight: bold;	color: #333333;}.Conteudo {	font-family: Arial;	font-size: 10px;	font-weight: normal;}.Caixa{	BORDER-RIGHT: #6699CC 1px solid; 	BORDER-TOP: #6699CC 1px solid; 	FONT: 8pt Arial ;	BORDER-LEFT: #6699CC 1px solid; 	BORDER-BOTTOM: #6699CC 1px solid; 	BACKGROUND-COLOR: #FFFFFF;}.Erro{	BORDER-RIGHT: #990000 1px solid; 	BORDER-TOP: #990000 1px solid; 	FONT: 10pt Arial ;	COLOR: #ffffff;	BORDER-LEFT: #990000 1px solid; 	BORDER-BOTTOM: #990000 1px solid; 	BACKGROUND-COLOR: #FF0000;}</style><script language="javascript" src="js/cal2.js"></script><script language="javascript" src="js/cal_conf2.js"></script><script language='javascript' src='../ajax.js'></script><script language='javascript'>function createRequestObject(){	var request_;	var browser = navigator.appName;	if(browser == "Microsoft Internet Explorer"){		 request_ = new ActiveXObject("Microsoft.XMLHTTP");	}else{		 request_ = new XMLHttpRequest();	}	return request_;}var http_forn = new Array();function gravar_treinamento(formulatio) {	var acao='cadastrar';	url = "<?=$PHP_SELF?>?ajax=sim&acao="+acao;	parametros = "";	for( var i = 0 ; i < formulatio.length; i++ ){		if (formulatio.elements[i].type !='button'){			if(formulatio.elements[i].type=='radio' || formulatio.elements[i].type=='checkbox'){				if(formulatio.elements[i].checked == true){					parametros = parametros+"&"+formulatio.elements[i].name+"="+escape(formulatio.elements[i].value);				}			}else{				parametros = parametros+"&"+formulatio.elements[i].name+"="+escape(formulatio.elements[i].value);			}		}	}	url = url + parametros;	var com = document.getElementById('erro');	var curDateTime = new Date();	http_forn[curDateTime] = createRequestObject();	http_forn[curDateTime].open('GET',url,true);	http_forn[curDateTime].onreadystatechange = function(){		if (http_forn[curDateTime].readyState == 4){			if (http_forn[curDateTime].status == 200 || http_forn[curDateTime].status == 304){				var response = http_forn[curDateTime].responseText.split("|");				if (response[0]=="ok"){					alert(response[1]);					for( var i = 0 ; i < formulatio.length; i++ ){						if (formulatio.elements[i].type=='text' || formulatio.elements[i].type=='select-one' || 	formulatio.elements[i].type=='textarea' || formulatio.elements[i].type=='hidden'){							formulatio.elements[i].value = "";						}					}					formulatio.bt_cad_forn.value='Gravar';					com.style.visibility = "hidden";					mostrar_treinamento('dados');				}				if (response[0]=="1"){										//alert(response[1]);					com.innerHTML = response[1];					com.style.visibility = "visible";					formulatio.bt_cad_forn.value='Gravar';				}			}		}	}	http_forn[curDateTime].send(null);}function mostrar_treinamento(componente) {	var com = document.getElementById(componente);	var acao='ver';	url = "<?=$PHP_SELF?>?ajax=sim&acao="+acao;	com.innerHTML   ="Carregando<br><img src='imagens/carregar2.gif'>";	var curDateTime = new Date();	http_forn[curDateTime] = createRequestObject();	http_forn[curDateTime].open('GET',url,true);	http_forn[curDateTime].onreadystatechange = function(){		if (http_forn[curDateTime].readyState == 4) 		{			if (http_forn[curDateTime].status == 200 || http_forn[curDateTime].status == 304) 			{				var response = http_forn[curDateTime].responseText.split("|");				if (response[0]=="ok"){					com.innerHTML   = response[1];				}				if (response[0]=="0"){					alert(response[1]);				}			}		}	}	http_forn[curDateTime].send(null);}</script><? include "javascript_pesquisas.php" ?><?$promotor_treinamento = $_GET["promotor_treinamento"];if(strlen($promotor_treinamento)>0){	$sql = "SELECT tbl_promotor_treinamento.*		FROM tbl_promotor_treinamento		WHERE promotor_treinamento = $promotor_treinamento		AND tbl_promotor_treinamento.fabrica = $login_fabrica";	$res = pg_exec ($con,$sql);	if (pg_numrows($res) > 0) {		$promotor     = trim(pg_result($res,0,promotor_treinamento));		$nome         = trim(pg_result($res,0,nome));		$email        = trim(pg_result($res,0,email));		$ativo        = trim(pg_result($res,0,ativo));		$tipo_posto   = trim(pg_result($res,0,tipo_posto));		$regiao       = trim(pg_result($res,0,regiao));	}}if(strlen($msg)>0)	echo "<font color='#009900'>$msg</font>";if(strlen($msg_erro)>0){	echo "<font color='#990000'>".$msg_erro."</font>";}?><FORM name="frm_relatorio" METHOD="POST" ACTION="<? echo $PHP_SELF ?>"><?echo "<input type='hidden' name='promotor' id='promotor' value='$promotor'>";?><div id='erro' style='visibility:hidden;opacity:.85;' class='Erro'></div><div id='carregando' style='position: absolute;visibility:hidden;opacity:.90;' class='Carregando' width='150'></div><table width='500' class='Conteudo' style='background-color: #485989' border='0' cellpadding='5' cellspacing='1' align='center'>		<tr>		<td class='Titulo' background='imagens_admin/azul.gif'><b>PROMOTOR</b></td>	</tr>		<tr>		<td bgcolor='#DBE5F5' valign='bottom'>				<table width='100%' border='0' cellspacing='1' cellpadding='2' >				<tr class="Conteudo" bgcolor="#D9E2EF">					<td width="10">&nbsp;</td>					<td align='right' nowrap>Nome</td>					<td align='left' colspan='3'>						<input type="text" name="nome" id='nome' size="60" maxlength="80" class='Caixa' value="<? if (strlen($nome) > 0) echo $nome; ?>">					</td>					<td width="10">&nbsp;</td>				</tr>				<tr class="Conteudo" bgcolor="#D9E2EF">					<td width="10">&nbsp;</td>					<td align='right' nowrap>Email</td>					<td align='left' colspan='3'>						<input type="text" name="email" id='email' size="60" maxlength="100" class='Caixa' value="<? if (strlen($email) > 0) echo $email; ?>">					</td>					<td width="10">&nbsp;</td>				</tr>				<tr class="Conteudo" bgcolor="#D9E2EF">					<td width="10">&nbsp;</td>					<td align='right'>Região</td>					<td align='left'>						<?					$sql = "SELECT DISTINCT regiao FROM tbl_estado WHERE trim(regiao)<>'' ORDER BY regiao;";					$res = pg_exec ($con,$sql);										if (pg_numrows($res) > 0) {						echo "<select name='regiao' id='regiao' class='Caixa'>\n";						echo "<option value=''>ESCOLHA</option>\n";												for ($x = 0 ; $x < pg_numrows($res) ; $x++){							$aux_regiao = trim(pg_result($res,$x,regiao));														echo "<option value='$aux_regiao'"; 							if ($regiao == $aux_regiao){								echo " SELECTED "; 							}							echo ">$aux_regiao</option>\n";						}						echo "</select>\n";					}					?>					</td>					<td width="10">&nbsp;</td>				</tr>				<tr class="Conteudo" bgcolor="#D9E2EF">					<td width="10">&nbsp;</td>					<td align='right'>Escritório</td>					<td align='left'>						<?					$sql = "SELECT DISTINCT codigo,tipo_posto FROM tbl_tipo_posto WHERE fabrica=$login_fabrica ORDER BY codigo;";					$res = pg_exec ($con,$sql);										if (pg_numrows($res) > 0) {						echo "<select name='regiao' id='regiao' class='Caixa'>\n";						echo "<option value=''>ESCOLHA</option>\n";												for ($x = 0 ; $x < pg_numrows($res) ; $x++){							$aux_codigo     = trim(pg_result($res,$x,codigo));							$aux_tipo_posto = trim(pg_result($res,$x,tipo_posto));														echo "<option value='$aux_tipo_posto'"; 							if ($tipo_posto == $aux_tipo_posto){								echo " SELECTED "; 							}							echo ">$aux_codigo</option>\n";						}						echo "</select>\n";					}					?>					</td>					<td width="10">&nbsp;</td>				</tr>				<tr class="Conteudo" bgcolor="#D9E2EF">					<td width="10">&nbsp;</td>					<td align='right' nowrap>Ativo</td>					<td align='left' colspan='3'>						<input type="checkbox" name="ativo" id='ativo' size="60" maxlength="100" class='Caixa' value="t" <? if (strlen($ativo) > 0) echo "CHECKED"; ?>>					</td>					<td width="10">&nbsp;</td>				</tr>			</table><br>			<INPUT TYPE='button' name='bt_cad_forn' id='bt_cad_forn' value='Gravar' onClick="if (this.value=='Gravando...'){ alert('Aguarde');}else {this.value='Gravando...'; gravar_treinamento(this.form);}">		</td>	</tr></table></FORM><?echo "<h1>Promotor cadastrado</h1>";echo "<div id='dados'></div>";echo "<script language='javascript'>mostrar_treinamento('dados');</script>";?><p><? include "rodape.php" ?>