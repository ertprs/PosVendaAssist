<?include 'dbconfig.php';include 'includes/dbconnect-inc.php';include "autentica_admin.php";if ($_GET["posto"]){		$posto = $_GET["posto"];	$sql_tipo = " 120, 122, 123, 126 ";	$aprovacao = " 120, 122 ";	$sql = "SELECT DISTINCT os					INTO TEMP tmp_interv_90_2$login_admin					FROM tbl_os_status					WHERE status_os IN ($sql_tipo);					SELECT						interv.os						INTO TEMP tmp_interv_90_$login_admin					FROM (						SELECT						ultima.os,						(							SELECT status_os							FROM tbl_os_status							WHERE status_os IN ($sql_tipo)								AND tbl_os_status.os = ultima.os							ORDER BY data							DESC LIMIT 1						) AS ultimo_status						FROM (								SELECT os FROM tmp_interv_90_2$login_admin						) ultima					) interv					WHERE interv.ultimo_status IN ($aprovacao)					$Xos					;					CREATE INDEX tmp_interv_OS_90_$login_admin ON tmp_interv_90_$login_admin(os);					SELECT	count(tbl_os.os) as qtde_os					FROM tmp_interv_90_$login_admin X					JOIN tbl_os ON tbl_os.os = X.os					WHERE tbl_os.fabrica = $login_fabrica					AND data_abertura < (current_date - interval '90 days')					AND excluida IS NOT TRUE					AND finalizada IS NULL					AND posto = $posto";					$res = pg_exec($con,$sql);//		echo nl2br($sql);			if(pg_numrows($res)>0){							$qtde_os = pg_result($res,0,qtde_os);						}		$sql_sem = "SELECT count(*) AS qtde_sem					FROM (						SELECT						ultima.os,						(							SELECT status_os							FROM tbl_os_status							WHERE status_os IN ($aprovacao)								AND tbl_os_status.os = ultima.os							ORDER BY data							DESC LIMIT 1						) AS ultimo_status						FROM (								SELECT DISTINCT os								FROM tmp_interv_90_$login_admin								JOIN tbl_os USING(os)								WHERE posto   = $posto								AND   fabrica = $login_fabrica								AND data_abertura < (current_date - interval '90 days')								AND excluida is not true								AND finalizada is null						) ultima					) interv					JOIN tbl_os USING(os)					WHERE interv.ultimo_status IN (120)					AND   tbl_os.posto = $posto					AND data_abertura < (current_date - interval '90 days')					AND excluida is not true					AND finalizada is null					AND fabrica  = $login_fabrica";		//if($ip == '201.76.71.206') echo nl2br($sql_sem);		$res_sem = pg_exec($con,$sql_sem);			if (pg_numrows($res_sem) > 0) $qtde_sem = pg_result($res_sem,0,qtde_sem);		else                          $qtde_sem = 0;		$sql_com = "SELECT count(*) as qtde_com					FROM (					SELECT					ultima.os,					(						SELECT status_os						FROM tbl_os_status						WHERE status_os IN ($aprovacao)							AND tbl_os_status.os = ultima.os						ORDER BY data						DESC LIMIT 1					) AS ultimo_status					FROM (							SELECT DISTINCT os							FROM tmp_interv_90_$login_admin							JOIN tbl_os USING(os)							WHERE posto   = $posto							AND   fabrica = $login_fabrica							AND data_abertura < (current_date - interval '90 days')							AND excluida is not true							AND finalizada is null					) ultima				) interv				JOIN tbl_os USING(os)				WHERE interv.ultimo_status IN (122)				AND   tbl_os.posto = $posto				AND data_abertura < (current_date - interval '90 days')				AND excluida is not true				AND finalizada is null				AND fabrica  = $login_fabrica";		$res_com = pg_exec($con,$sql_com);		if (pg_numrows($res_com) > 0) $qtde_com = pg_result($res_com,0,qtde_com);		else                          $qtde_com = 0;			echo "$qtde_os|$qtde_sem|$qtde_com";}	?>